(function(a){a.fn.formset=function(b){var c=a.extend({},a.fn.formset.defaults,b),d=c.extraClasses.join(" "),e=a(this),f=e.parent(),g=function(a,b){if(c.extraClasses){a.removeClass(d);a.addClass(c.extraClasses[b%c.extraClasses.length])}},h=function(a,b,c){var d=new RegExp("(^id_"+b+"-\\d+-)|(^)"),e="id_"+b+"-"+c+"-";var f=new RegExp("(^"+b+"-\\d+-)|(^)"),g=b+"-"+c+"-";if(a.attr("for"))a.attr("for",a.attr("for").replace(d,e));if(a.attr("id"))a.attr("id",a.attr("id").replace(d,e));if(a.attr("name"))a.attr("name",a.attr("name").replace(f,g))},i=function(a){return a.find("input,select,textarea,label").length>0},j=function(b){if(b.is("TR")){b.children(":last").append('<a class="'+c.deleteCssClass+'" href="javascript:void(0)">'+c.deleteText+"</a>")}else if(b.is("UL")||b.is("OL")){b.append('<li><a class="'+c.deleteCssClass+'" href="javascript:void(0)">'+c.deleteText+"</a></li>")}else{b.append('<a class="'+c.deleteCssClass+'" href="javascript:void(0)">'+c.deleteText+"</a>")}b.find("a."+c.deleteCssClass).click(function(){var b=a(this).parents("."+c.formCssClass),d=b.find('input:hidden[id $= "-DELETE"]');if(c.beforeremove)c.beforeremove(b);if(d.length){d.val("on");b.hide()}else{b.remove();var e=a("."+c.formCssClass).not(".formset-custom-template");a("#id_"+c.prefix+"-TOTAL_FORMS").val(e.length);for(var f=0,i=e.length;f<i;f++){g(e.eq(f),f);e.eq(f).find("input,select,textarea,label").each(function(){h(a(this),c.prefix,f)})}}k();if(c.removed)c.removed(b);return false})},k=function(){var b=parseInt(a("#id_"+c.prefix+"-MAX_NUM_FORMS").val()),d=f.find("."+c.formCssClass).length;if(c.min_num>0){if(d<=c.min_num){f.find("."+c.deleteCssClass).hide()}else{f.find("."+c.deleteCssClass+":gt("+(c.min_num-1)+")").show()}}if(b>0){if(d>=b){f.find("."+c.addCssClass).hide()}else{f.find("."+c.addCssClass).show()}}};e.each(function(b){var d=a(this),e=d.find('input:checkbox[id $= "-DELETE"]');if(e.length){e.before('<input type="hidden" name="'+e.attr("name")+'" id="'+e.attr("id")+'" />');e.remove()}if(i(d)){j(d);d.addClass(c.formCssClass);g(d,b)}k()});if(e.length){var l,m;if(c.formTemplate){m=c.formTemplate instanceof a?c.formTemplate:a(c.formTemplate);m.removeAttr("id").addClass(c.formCssClass).addClass("formset-custom-template");m.find("input,select,textarea,label").each(function(){h(a(this),c.prefix,2012)});j(m)}else{m=a("."+c.formCssClass+":last").clone(true).removeAttr("id");m.find('input:hidden[id $= "-DELETE"]').remove();m.find("input,select,textarea,label").each(function(){var b=a(this);if(b.is("input:checkbox")||b.is("input:radio")){b.attr("checked",false)}else{b.val("")}})}c.formTemplate=m;if(e.attr("tagName")=="TR"){var n=e.eq(0).children().length;e.parent().append('<tr><td colspan="'+n+'"><a class="'+c.addCssClass+'" href="javascript:void(0)">'+c.addText+"</a></tr>");l=e.parent().find("tr:last a");l.parents("tr").addClass(c.formCssClass+"-add")}else{e.filter(":last").after('<a class="'+c.addCssClass+'" href="javascript:void(0)">'+c.addText+"</a>");l=e.filter(":last").next()}l.click(function(){var b=parseInt(a("#id_"+c.prefix+"-TOTAL_FORMS").val()),d=c.formTemplate.clone(true).removeClass("formset-custom-template"),e=a(this).parents("tr."+c.formCssClass+"-add").get(0)||this;g(d,b);if(c.beforeadd)c.beforeadd(d);d.insertBefore(a(e)).show();d.find("input,select,textarea,label").each(function(){var d=a(this);h(d,c.prefix,b);if(d.is("input:checkbox")||d.is("input:radio")){d.attr("checked",false)}else{d.val("")}});a("#id_"+c.prefix+"-TOTAL_FORMS").val(b+1);k();if(c.added)c.added(d);return false})}return e};a.fn.formset.defaults={prefix:"form",min_num:0,formTemplate:null,addText:"add another",deleteText:"remove",addCssClass:"add-row",deleteCssClass:"delete-row",formCssClass:"dynamic-form",extraClasses:[],beforeadd:null,added:null,beforeremove:null,removed:null}})(jQuery)
